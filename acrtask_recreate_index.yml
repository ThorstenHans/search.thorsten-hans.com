version: v1.1.0
secrets:
    - id: searchServiceName
      keyvault: https://unleashed.vault.azure.net/secrets/SearchServiceName
    - id: searchApiKey
      keyvault: https://unleashed.vault.azure.net/secrets/SearchServiceApiKey
steps:
    - id: build-image
      build: -t $Registry/blog-search:1 .
      env:
        - THNS__AZ_SEARCH_ADMIN_KEY={{.Secrets.searchApiKey}}
          - THNS__AZ_SEARCH_SERVICE_NAME={{.Secrets.searchServiceName}}
    - id: push-image
      push: 
        - $Registry/blog-search:$ID
    - id: run-feed-index-container
      cmd: $Registry/blog-search:$ID