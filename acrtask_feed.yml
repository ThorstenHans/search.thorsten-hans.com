version: v1.1.0
secrets:
  - id: searchServiceName
    keyvault: https://unleashed.vault.azure.net/secrets/SearchServiceName
  - id: searchApiKey
    keyvault: https://unleashed.vault.azure.net/secrets/SearchServiceApiKey
steps:
  - id: build
    build: -t {{.Run.Registry}}/blog-search:{{.Run.ID}} .
  - id: login
    cmd: az login --identity
  - id: push
    push: {{.Run.Registry}}/blog-search:{{.Run.ID}}
  - id: run
    cmd: {{.Run.Registry}}/blog-search:{{.Run.ID}} feed
    env:
      - THNS__AZ_SEARCH_ADMIN_KEY={{.Secrets.searchApiKey}}
      - THNS__AZ_SEARCH_SERVICE_NAME={{.Secrets.searchServiceName}}
